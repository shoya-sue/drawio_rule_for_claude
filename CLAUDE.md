# drawio図解生成ルール

## 目的・対象範囲

### 目的

ユーザーがローカルに配置した元ソース（画像、プログラムソース、ドキュメント等）を解析し、依頼に応じた図解資料をdrawio XML形式で生成する。

### ターゲットユーザー

**要件定義を実施しているディレクター向け**のツール。

### 対象レベル

| レベル | 要素数目安 | 対応状況 |
|-------|-----------|---------|
| シンプル | 3-5要素 | 対応 |
| 中程度 | 10-20要素 | 対応（メイン対象） |
| 複雑 | 20要素以上、多層構造 | 対象外 |

### 品質基準

- **ドラフト品質**で十分とする
- 簡単な手直しで完成する状態を目指す
- 完璧な出力は求めない

### 入力ソース

Claudeが認識できるデータであれば何でも可：
- 画像データ（スクリーンショット、既存図解など）
- プログラムソース
- ドキュメント（テキスト、Markdown等）
- その他テキストベースのデータ

### 想定する図解の種類

要件定義で使用される図解：

| カテゴリ | 図解種類 | 用途 |
|---------|---------|-----|
| プロセス系 | 業務フロー図 | 業務手順の可視化 |
| プロセス系 | データフロー図 | データの流れを表現 |
| プロセス系 | シーケンス図 | 処理の時系列表現 |
| 構造系 | システム構成図 | システム全体像 |
| 構造系 | ER図 | データベース設計 |
| 構造系 | コンテキスト図 | システム境界と外部との関係 |
| 振る舞い系 | 画面遷移図 | UI/UXの流れ |
| 振る舞い系 | 状態遷移図 | 状態変化の定義 |
| 振る舞い系 | ユースケース図 | アクターと機能の関係 |

---

## 生成ルール

このプロジェクトでは、drawio形式（.drawio）のXMLファイルを生成します。
以下のルールに従って図解を生成してください。

### 1. mxGraphModel設定

```xml
<mxGraphModel
  dx="0"
  dy="0"
  grid="1"
  gridSize="10"
  guides="1"
  tooltips="1"
  connect="1"
  arrows="1"
  fold="1"
  page="0"
  pageScale="1"
  pageWidth="827"
  pageHeight="1169"
  background="none"
  defaultFontFamily="Helvetica">
```

必須属性：
- `background="none"` - 透明背景
- `page="0"` - ページ境界非表示
- `defaultFontFamily="Helvetica"` - デフォルトフォント

### 2. フォント設定（最重要）

**mxGraphModelのdefaultFontFamily属性だけでは不十分です。**

すべてのmxCell要素のstyle属性に以下を必ず含めてください：
- `fontFamily=Helvetica;`
- `fontSize=18;`（標準の1.5倍、視認性確保）

```xml
<!-- 正しい例 -->
<mxCell style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=18;" ... />

<!-- 誤った例（fontFamilyが欠落） -->
<mxCell style="rounded=1;whiteSpace=wrap;html=1;" ... />
```

### 3. 要素配置順（描画順序）

XMLの記述順序が描画順序を決定します：
- **先に記述 → 背面に配置**
- **後に記述 → 前面に配置**

**矢印を最前面に配置する**ため、以下の順序で記述してください：

```xml
<root>
  <mxCell id="0" />
  <mxCell id="1" parent="0" />

  <!-- 1. 凡例グループ（最背面） -->
  <mxCell id="legend" style="swimlane;..." vertex="1" ... />

  <!-- 2. グループ/コンテナ（swimlane） -->
  <mxCell id="group-1" style="swimlane;..." vertex="1" ... />

  <!-- 3. 図形（vertex） -->
  <mxCell id="box-1" vertex="1" ... />
  <mxCell id="box-2" vertex="1" ... />

  <!-- 4. 矢印（edge）を最後に記述 → 最前面 -->
  <mxCell id="arrow-1" edge="1" ... />
  <mxCell id="arrow-2" edge="1" ... />
</root>
```

### 4. 日本語テキスト

- 1文字あたり30-40pxの幅を確保
- 意図しない改行を防止するため、十分な幅を設定

```xml
<!-- 4文字の日本語テキスト → 幅120-160px必要 -->
<mxGeometry x="100" y="100" width="160" height="60" as="geometry" />
```

### 5. 矢印スタイル

- 矢印の形: `endArrow=classic;endFill=1`（視認性の高いクラシック形状）
- 線の色: `strokeColor=#333333`（濃いグレーで視認性確保）
- 線の太さ: `strokeWidth=2`
- **双方向矢印は2本に分離**（1本だとラベルが重なる）

### 6. 矢印ラベル

- フォントサイズ: 12px（図形より小さく）
- 文字色: `fontColor=#666666`（図形より薄く）
- 矢印のラベルは矢印から20px以上離す

### 7. 矢印接続時の余白

矢印ラベルを表示するため、要素間に十分な余白を確保：
- 横方向: 100-120px（最小80px）
- 縦方向: 80-100px（最小60px）

## 参照ファイル

| ファイル | 用途 |
|---------|-----|
| `rules/style-guide.md` | **カラー・図形・フォントのルール** |
| `rules/layout-guide.md` | **座標・サイズ・間隔・接続のルール** |
| `rules/prompt-template.md` | 依頼時のプロンプトテンプレート |
| `rules/checklist.md` | 生成前後のチェックリスト |
| `templates/*.drawio` | 図解種類別のXMLテンプレート |

## スタイルクイックリファレンス

### カラーパレット（用途別）

| 用途 | 背景色 | 枠線色 |
|-----|--------|--------|
| 入力/開始/クライアント | `#dae8fc` | `#6c8ebf` |
| 処理/中間/アプリ層 | `#fff2cc` | `#d6b656` |
| 出力/完了/データ層 | `#d5e8d4` | `#82b366` |
| 警告/エラー/外部 | `#f8cecc` | `#b85450` |
| その他/認証 | `#e1d5e7` | `#9673a6` |

### フォント設定

| 項目 | 値 |
|-----|-----|
| フォント | Helvetica |
| 図形文字色 | `fontColor=#333333`（必須） |
| 図形内テキスト | 18px |
| 矢印ラベル | 12px |
| 矢印文字色 | `fontColor=#666666` |
| 線の太さ | strokeWidth=2 |

詳細は `rules/style-guide.md` を参照。

### レイアウト基準

| 項目 | 値 |
|-----|-----|
| 標準ボックス | 120-140 × 60 |
| 矢印あり要素間隔（横） | 100-120px |
| 矢印あり要素間隔（縦） | 80-100px |
| 矢印なし要素間隔 | 40-60px |
| 開始位置 | x=100, y=40〜100 |
| 日本語幅 | 文字数 × 30-35 + 20 |

詳細は `rules/layout-guide.md` を参照。

## 生成後の確認事項

生成したdrawioファイルは以下を確認：
- [ ] 全テキスト要素にfontFamily設定済み
- [ ] フォントサイズ18px以上
- [ ] 矢印が最前面に配置されている
- [ ] 日本語テキストに意図しない改行なし

## PNG変換コマンド

```bash
drawio -x -f png -s 2 -t -o output.png input.drawio
```

| オプション | 意味 |
|-----------|-----|
| `-x` | エクスポートモード |
| `-f png` | PNG形式 |
| `-s 2` | 2倍スケール |
| `-t` | 透明背景 |
