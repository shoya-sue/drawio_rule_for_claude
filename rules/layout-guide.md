# drawio レイアウトガイド

図解生成時の配置・サイズ・接続に関するルールを定義します。

---

## 1. 座標システム

### 1.1 基本概念

| 項目 | 説明 |
|-----|------|
| 原点 | 左上が (0, 0) |
| X軸 | 右方向が正 |
| Y軸 | 下方向が正 |
| 単位 | ピクセル（px） |
| グリッド | 10px単位（gridSize="10"） |

### 1.2 座標の決め方

```xml
<mxGeometry x="100" y="100" width="140" height="60" as="geometry" />
```

| 属性 | 説明 |
|-----|------|
| x | 左上角のX座標 |
| y | 左上角のY座標 |
| width | 要素の幅 |
| height | 要素の高さ |

### 1.3 推奨開始位置

| 図解種類 | 開始位置 | 説明 |
|---------|---------|------|
| 横並びフロー | x=100, y=100 | 左から右へ展開 |
| 縦並びフロー | x=100, y=40 | 上から下へ展開 |
| 中央配置 | x=200-300, y=150-200 | コンテキスト図等 |

---

## 2. サイズ基準

### 2.1 標準サイズ

| 要素種類 | 幅（width） | 高さ（height） | 備考 |
|---------|-----------|--------------|------|
| 標準ボックス | 120-140 | 60 | 日本語4-5文字 |
| 大きいボックス | 160-200 | 70-80 | 日本語6-8文字、2行 |
| 小さいボックス | 80-100 | 40-50 | 英数字、短いラベル |
| データベース（円柱） | 100-140 | 70-80 | size=15推奨 |
| アクター（人型） | 30-40 | 60 | 固定比率 |
| 楕円（開始/終了） | 100-120 | 50-60 | |
| ひし形（分岐） | 100-120 | 70-80 | テキストが収まるサイズ |

### 2.2 日本語テキストのサイズ計算

| 文字数 | 推奨幅 | 計算式 |
|-------|-------|-------|
| 2文字 | 80px | 2 × 35 + 10（余白） |
| 4文字 | 140px | 4 × 30 + 20 |
| 6文字 | 200px | 6 × 30 + 20 |
| 8文字 | 260px | 8 × 30 + 20 |

**計算式:** `幅 = 文字数 × 30〜35 + 余白20`

### 2.3 高さの目安

| 行数 | 推奨高さ |
|-----|---------|
| 1行 | 50-60px |
| 2行 | 70-80px |
| 3行 | 90-100px |

---

## 3. 間隔・マージン

### 3.1 要素間の間隔

| 配置方向 | 最小間隔 | 推奨間隔 | 説明 |
|---------|---------|---------|------|
| 水平方向 | 40px | 60-80px | ボックス間の横の距離 |
| 垂直方向 | 40px | 60-80px | ボックス間の縦の距離 |
| 矢印ラベル | 20px | 20-30px | 矢印とラベルの距離 |

### 3.2 レイヤー間の間隔

システム構成図など、レイヤー構造がある場合：

| 間隔種類 | 推奨値 |
|---------|-------|
| レイヤー間 | 100-120px |
| レイヤー内要素間 | 60-80px |
| レイヤーラベルと要素 | 30-40px |

### 3.3 配置パターン

#### 横並び（左→右）

```
[要素1] --60px-- [要素2] --60px-- [要素3]
x=100           x=300           x=500
```

#### 縦並び（上→下）

```
[要素1] y=40
   |
 80px
   |
[要素2] y=140
   |
 80px
   |
[要素3] y=240
```

#### グリッド配置

```
[要素1] x=100  [要素2] x=300  [要素3] x=500
        y=100          y=100          y=100

[要素4] x=100  [要素5] x=300  [要素6] x=500
        y=200          y=200          y=200
```

---

## 4. 接続ポイント

### 4.1 基本概念

矢印の接続位置を制御する属性：

| 属性 | 説明 | 値の範囲 |
|-----|------|---------|
| exitX | 出発点のX位置 | 0（左端）〜 1（右端） |
| exitY | 出発点のY位置 | 0（上端）〜 1（下端） |
| entryX | 到着点のX位置 | 0（左端）〜 1（右端） |
| entryY | 到着点のY位置 | 0（上端）〜 1（下端） |

### 4.2 よく使う接続パターン

| パターン | exit | entry | 用途 |
|---------|------|-------|-----|
| 右→左 | exitX=1, exitY=0.5 | entryX=0, entryY=0.5 | 横並びフロー |
| 下→上 | exitX=0.5, exitY=1 | entryX=0.5, entryY=0 | 縦並びフロー |
| 右下→左上 | exitX=1, exitY=1 | entryX=0, entryY=0 | 斜め接続 |
| 中央→中央 | (省略) | (省略) | 自動接続 |

### 4.3 接続の記述例

```xml
<!-- 明示的な接続ポイント指定 -->
<mxCell
  style="...exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;"
  edge="1"
  source="box-1"
  target="box-2">
  <mxGeometry relative="1" as="geometry" />
</mxCell>
```

### 4.4 接続の推奨事項

| 状況 | 推奨 |
|-----|-----|
| 単純な接続 | source/targetのみ（自動接続） |
| 位置を制御したい | exitX/Y, entryX/Yを明示 |
| 複雑な経路 | pointsで中間点を指定 |

### 4.5 中間点の指定

```xml
<mxCell edge="1" source="box-1" target="box-3">
  <mxGeometry relative="1" as="geometry">
    <Array as="points">
      <mxPoint x="200" y="150" />
      <mxPoint x="200" y="250" />
    </Array>
  </mxGeometry>
</mxCell>
```

---

## 5. ID命名規則

### 5.1 基本ルール

| ルール | 説明 |
|-------|------|
| 一意性 | ファイル内で重複しない |
| 形式 | 英数字とハイフン（-）を使用 |
| 予約ID | "0" と "1" は予約済み |

### 5.2 命名パターン

| 要素種類 | パターン | 例 |
|---------|---------|-----|
| ボックス/状態 | `{種類}-{番号}` | `box-1`, `state-pending` |
| 矢印/エッジ | `edge-{番号}` または `{from}-to-{to}` | `edge-1`, `login-to-home` |
| アクター | `actor-{名前}` | `actor-user`, `actor-admin` |
| エンティティ | `entity-{テーブル名}` | `entity-users` |
| グループ | `group-{名前}` | `group-auth` |

### 5.3 図解種類別の例

```xml
<!-- 業務フロー図 -->
<mxCell id="start" ... />
<mxCell id="process-1" ... />
<mxCell id="decision-1" ... />
<mxCell id="end" ... />

<!-- システム構成図 -->
<mxCell id="client" ... />
<mxCell id="web-server" ... />
<mxCell id="app-server" ... />
<mxCell id="database" ... />

<!-- ユースケース図 -->
<mxCell id="actor-user" ... />
<mxCell id="uc-login" ... />
<mxCell id="uc-search" ... />
```

---

## 6. グループ化

### 6.1 parent属性

| parent値 | 意味 |
|---------|------|
| "0" | ルート（使用しない） |
| "1" | 標準の親（通常はこれ） |
| 他のID | そのIDの要素の子になる |

### 6.2 グループ化の例

```xml
<!-- グループコンテナ -->
<mxCell id="group-layer1"
        value="アプリケーション層"
        style="swimlane;..."
        vertex="1"
        parent="1">
  <mxGeometry x="50" y="100" width="300" height="200" as="geometry" />
</mxCell>

<!-- グループ内の要素（parentをグループIDに設定） -->
<mxCell id="server-1"
        value="サーバー1"
        style="rounded=1;..."
        vertex="1"
        parent="group-layer1">
  <!-- 座標はグループ内の相対座標 -->
  <mxGeometry x="20" y="40" width="100" height="50" as="geometry" />
</mxCell>
```

### 6.3 グループ化の用途

| 用途 | 説明 |
|-----|------|
| レイヤー表現 | システム構成図の層 |
| システム境界 | ユースケース図の境界 |
| スイムレーン | 業務フロー図の担当者別 |
| 論理グループ | 関連要素のまとめ |

---

## 7. 図解種類別レイアウト

### 7.1 業務フロー図

```
方向: 上→下（推奨）または 左→右
開始位置: x=100, y=40
要素間隔: 80-100px
分岐の幅: 150-200px（Yes/No両方向）
```

### 7.2 システム構成図

```
方向: 上→下（レイヤー構造）
レイヤー間隔: 100-120px
レイヤー内: 横並び、間隔60-80px
外部システム: 右側または下側に配置
```

### 7.3 画面遷移図

```
方向: 左→右 または グリッド配置
画面間隔: 150-200px（矢印ラベル用の余裕）
戻り矢印: 下側を迂回
```

### 7.4 ER図

```
配置: グリッド状
エンティティ間隔: 80-100px
関連テーブル: 近くに配置
```

### 7.5 シーケンス図

```
アクター/オブジェクト間隔: 150px
ライフライン開始Y: 80px
メッセージ間隔: 50px
```

### 7.6 ユースケース図

```
アクター位置: 左右の端（x=40 または x=500）
ユースケース: 中央（x=200-350）
システム境界: ユースケースを囲む
```

### 7.7 コンテキスト図

```
中央システム: x=250, y=180付近
外部エンティティ: 周囲に等間隔で配置
推奨配置: 上下左右の4方向
```

### 7.8 状態遷移図

```
方向: 左→右 が基本
開始マーカー: 左端
終了マーカー: 右端
異常系: 下側に配置
```

---

## 8. レイアウト例（座標付き）

### 8.1 横3要素フロー

```xml
<!-- 要素1: 開始 -->
<mxGeometry x="100" y="100" width="120" height="60" />

<!-- 要素2: 処理 -->
<mxGeometry x="280" y="100" width="120" height="60" />

<!-- 要素3: 終了 -->
<mxGeometry x="460" y="100" width="120" height="60" />
```

### 8.2 縦4要素フロー

```xml
<!-- 要素1 -->
<mxGeometry x="100" y="40" width="140" height="60" />

<!-- 要素2 -->
<mxGeometry x="100" y="140" width="140" height="60" />

<!-- 要素3 -->
<mxGeometry x="100" y="240" width="140" height="60" />

<!-- 要素4 -->
<mxGeometry x="100" y="340" width="140" height="60" />
```

### 8.3 3層システム構成

```xml
<!-- プレゼンテーション層 -->
<mxGeometry x="100" y="40" width="140" height="60" />

<!-- アプリケーション層 -->
<mxGeometry x="100" y="160" width="140" height="60" />

<!-- データ層 -->
<mxGeometry x="100" y="280" width="140" height="60" />
```
